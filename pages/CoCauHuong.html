<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chi Tiết Cụm - Súng Cối 60mm</title>
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.3.0/model-viewer.min.js"></script>
    <style>
        body { margin: 0; background: #000; color: white; font-family: sans-serif; overflow: hidden; }
        
        /* Cụm Tiêu đề và Nút Quay lại ở giữa */
        .top-nav {
            position: absolute; top: 15px; width: 100%; 
            display: flex; flex-direction: column; align-items: center;
            z-index: 10; pointer-events: none;
        }

        .title-label {
            color: #4caf50; text-transform: uppercase;
            letter-spacing: 2px; font-size: 14px; font-weight: bold;
            margin-bottom: 8px;
        }

        .back-btn {
            pointer-events: auto; /* Cho phép bấm nút */
            padding: 5px 12px; background: rgba(255,255,255,0.1);
            color: #ccc; border: 1px solid #444; border-radius: 3px;
            cursor: pointer; text-decoration: none; font-size: 10px;
            transition: 0.3s; text-transform: uppercase;
        }
        .back-btn:hover { background: rgba(255,255,255,0.2); color: white; border-color: #4caf50; }

        /* Hàng phím chức năng kỹ thuật xếp dọc bên phải */
        .tech-sidebar {
            position: absolute; right: 10px; top: 55%; transform: translateY(-50%);
            display: flex; flex-direction: column; gap: 8px; z-index: 10;
        }

        .btn-tech {
            width: 90px; padding: 10px 5px; cursor: pointer;
            background: rgba(255, 193, 7, 0.15); color: #ffc107;
            border: 1px solid #ffc107; border-radius: 3px;
            font-weight: bold; font-size: 10px; transition: 0.3s;
            text-align: center;
        }
        .btn-tech:hover { background: rgba(255, 193, 7, 0.3); box-shadow: 0 0 10px #ffc107; }

        model-viewer { width: 100vw; height: 100vh; }

        /* Tối ưu cho di động cực nhỏ */
        @media (max-width: 480px) {
            .btn-tech { width: 80px; font-size: 9px; }
            .title-label { font-size: 12px; }
        }
    </style>
</head>
<body>

    <div class="top-nav">
        <div class="title-label">MÔ HÌNH CHI TIẾT CỤM</div>
        <a href="../index.html" class="back-btn">← QUAY LẠI TRANG CHỦ</a>
    </div>

    <div class="tech-sidebar">
        <button class="btn-tech" onclick="playAnim('ThaoRoi')">THÁO RỜI</button>
        <button class="btn-tech" onclick="playAnim('LapGhep')">LẮP GHÉP</button>
        <button class="btn-tech" onclick="playAnim('CatBo')">CẮT BỔ</button>
    </div>

    <model-viewer id="tech-model" 
        src="../models/CoCauHuong.glb" 
        camera-controls 
        auto-rotate
        shadow-intensity="1">
    </model-viewer>

    <script>
  const modelViewer = document.querySelector("#tech-model");

function playAnim(action) {
    // Lấy danh sách thực tế các animation từ file GLB
    const anims = modelViewer.availableAnimations;
    
    // Kiểm tra nếu file không có animation
    if (anims.length === 0) {
        console.error("File 3D này không chứa animation nào!");
        return;
    }

    // Dừng mọi hành động trước khi chuyển clip
    modelViewer.pause();

    if (action === 'ThaoRoi') {
        // Chạy clip đầu tiên trong danh sách
        modelViewer.animationName = anims[0]; 
        modelViewer.currentTime = 0;
        modelViewer.play();
    } 
    else if (action === 'LapGhep') {
        // Nếu bạn có clip thứ 2 chuyên cho lắp ghép
        if (anims.length >= 2) {
            modelViewer.animationName = anims[1];
            modelViewer.currentTime = 0;
            modelViewer.play();
        } else {
            // Nếu chỉ có 1 clip, dùng hàm tua ngược clip 1
            modelViewer.animationName = anims[0];
            runReverse();
        }
    } 
    else if (action === 'CatBo') {
        // Chạy clip thứ 3 (nếu có)
        if (anims.length >= 3) {
            modelViewer.animationName = anims[2];
            modelViewer.currentTime = 0;
            modelViewer.play();
        } else {
            alert("File này không có clip thứ 3 cho Cắt bổ");
        }
    }
}

function runReverse() {
    modelViewer.pause();
    if (modelViewer.currentTime === 0) modelViewer.currentTime = modelViewer.duration;
    
    const step = () => {
        if (modelViewer.currentTime > 0) {
            modelViewer.currentTime -= 0.03;
            requestAnimationFrame(step);
        } else {
            modelViewer.pause();
        }
    };
    requestAnimationFrame(step);
}
    </script>
</body>
</html>
