<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chi Tiết Cụm - Súng Cối 60mm</title>
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.3.0/model-viewer.min.js"></script>
    <style>
        body { margin: 0; background: #000; color: white; font-family: sans-serif; overflow: hidden; }
        
        /* Cụm Tiêu đề và Nút Quay lại ở giữa */
        .top-nav {
            position: absolute; top: 15px; width: 100%; 
            display: flex; flex-direction: column; align-items: center;
            z-index: 10; pointer-events: none;
        }

        .title-label {
            color: #4caf50; text-transform: uppercase;
            letter-spacing: 2px; font-size: 14px; font-weight: bold;
            margin-bottom: 8px;
        }

        .back-btn {
            pointer-events: auto; /* Cho phép bấm nút */
            padding: 5px 12px; background: rgba(255,255,255,0.1);
            color: #ccc; border: 1px solid #444; border-radius: 3px;
            cursor: pointer; text-decoration: none; font-size: 10px;
            transition: 0.3s; text-transform: uppercase;
        }
        .back-btn:hover { background: rgba(255,255,255,0.2); color: white; border-color: #4caf50; }

        /* Hàng phím chức năng kỹ thuật xếp dọc bên phải */
        .tech-sidebar {
            position: absolute; right: 10px; top: 55%; transform: translateY(-50%);
            display: flex; flex-direction: column; gap: 8px; z-index: 10;
        }

        .btn-tech {
            width: 90px; padding: 10px 5px; cursor: pointer;
            background: rgba(255, 193, 7, 0.15); color: #ffc107;
            border: 1px solid #ffc107; border-radius: 3px;
            font-weight: bold; font-size: 10px; transition: 0.3s;
            text-align: center;
        }
        .btn-tech:hover { background: rgba(255, 193, 7, 0.3); box-shadow: 0 0 10px #ffc107; }

        model-viewer { width: 100vw; height: 100vh; }

        /* Tối ưu cho di động cực nhỏ */
        @media (max-width: 480px) {
            .btn-tech { width: 80px; font-size: 9px; }
            .title-label { font-size: 12px; }
        }
    </style>
</head>
<body>

    <div class="top-nav">
        <div class="title-label">MÔ HÌNH CHI TIẾT CỤM</div>
        <a href="../index.html" class="back-btn">← QUAY LẠI TRANG CHỦ</a>
    </div>

    <div class="tech-sidebar">
        <button class="btn-tech" onclick="playAnim('ThaoRoi')">THÁO RỜI</button>
        <button class="btn-tech" onclick="playAnim('LapGhep')">LẮP GHÉP</button>
        <button class="btn-tech" onclick="playAnim('CatBo')">CẮT BỔ</button>
    </div>

    <model-viewer id="tech-model" 
        src="../models/CoCauHuong.glb" 
        camera-controls 
        auto-rotate
        shadow-intensity="1">
    </model-viewer>

    <script>
   const modelViewer = document.querySelector("#tech-model");

function playAnim(action) {
    // model-viewer load xong mới có thể đọc danh sách animation
    const anims = modelViewer.availableAnimations;
    console.log("Danh sách clip:", anims);

    if (action === 'ThaoRoi') {
        // Giả sử clip '1' là Tháo rời
        modelViewer.animationName = anims[0]; 
        modelViewer.play();
    } 
    else if (action === 'LapGhep') {
        // Nếu clip '2' là lắp ghép thì dùng anims[1]
        // Nếu không có clip lắp ghép riêng, ta tua ngược clip 1
        modelViewer.animationName = anims[0];
        reverseAnimation(modelViewer);
    } 
    else if (action === 'CatBo') {
        // Giả sử clip '3' là Cắt bổ
        modelViewer.animationName = anims[2];
        modelViewer.play();
    }
}

// Hàm bổ trợ để chạy ngược Animation (vì model-viewer không hỗ trợ sẵn nút Reverse)
function reverseAnimation(viewer) {
    viewer.pause();
    let duration = viewer.duration;
    let currentTime = viewer.currentTime || duration;

    const step = () => {
        if (currentTime > 0) {
            currentTime -= 0.05; // Tốc độ tua ngược
            viewer.currentTime = currentTime;
            requestAnimationFrame(step);
        } else {
            viewer.pause();
            viewer.currentTime = 0;
        }
    };
    requestAnimationFrame(step);
}
    </script>
</body>
</html>
